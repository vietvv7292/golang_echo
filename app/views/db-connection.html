{{ template "header.html" . }}

  <h1 class="text-3xl font-bold text-blue-700 mb-4">üîó K·∫øt n·ªëi Database (PostgreSQL, MySQL) trong Golang v·ªõi Echo</h1>

  <p class="text-gray-700 mb-6">Trong b∆∞·ªõc n√†y, b·∫°n s·∫Ω h·ªçc c√°ch k·∫øt n·ªëi ·ª©ng d·ª•ng Golang s·ª≠ d·ª•ng Echo framework v·ªõi c∆° s·ªü d·ªØ li·ªáu nh∆∞ PostgreSQL ho·∫∑c MySQL.</p>

  <hr class="my-6">

  <h2 class="text-2xl font-semibold text-gray-800 mb-3">1Ô∏è‚É£ C√†i ƒë·∫∑t th∆∞ vi·ªán</h2>
  <p class="mb-3">S·ª≠ d·ª•ng GORM ƒë·ªÉ thao t√°c ORM, v√† c√†i ƒë·∫∑t driver t∆∞∆°ng ·ª©ng v·ªõi PostgreSQL ho·∫∑c MySQL:</p>
  <pre class="bg-gray-100 p-4 rounded-md overflow-x-auto text-sm"><code># PostgreSQL
go get -u gorm.io/gorm
go get -u gorm.io/driver/postgres

# MySQL
go get -u gorm.io/driver/mysql
</code></pre>

  <hr class="my-6">

  <h2 class="text-2xl font-semibold text-gray-800 mb-3">2Ô∏è‚É£ C·∫•u h√¨nh k·∫øt n·ªëi c∆° s·ªü d·ªØ li·ªáu</h2>

  <h3 class="text-xl font-medium text-gray-700 mt-4 mb-2">PostgreSQL</h3>
  <pre class="bg-gray-100 p-4 rounded-md overflow-x-auto text-sm"><code>import (
    "gorm.io/driver/postgres"
    "gorm.io/gorm"
)

func ConnectPostgres() (*gorm.DB, error) {
    dsn := "host=localhost user=postgres password=yourpassword dbname=yourdb port=5432 sslmode=disable"
    db, err := gorm.Open(postgres.Open(dsn), &gorm.Config{})
    return db, err
}
</code></pre>

  <h3 class="text-xl font-medium text-gray-700 mt-4 mb-2">MySQL</h3>
  <pre class="bg-gray-100 p-4 rounded-md overflow-x-auto text-sm"><code>import (
    "gorm.io/driver/mysql"
    "gorm.io/gorm"
)

func ConnectMySQL() (*gorm.DB, error) {
    dsn := "user:password@tcp(127.0.0.1:3306)/yourdb?charset=utf8mb4&parseTime=True&loc=Local"
    db, err := gorm.Open(mysql.Open(dsn), &gorm.Config{})
    return db, err
}
</code></pre>

  <hr class="my-6">

  <h2 class="text-2xl font-semibold text-gray-800 mb-3">3Ô∏è‚É£ S·ª≠ d·ª•ng k·∫øt n·ªëi trong ·ª©ng d·ª•ng</h2>
  <p class="mb-3">V√≠ d·ª• s·ª≠ d·ª•ng trong m·ªôt controller ho·∫∑c service:</p>
  <pre class="bg-gray-100 p-4 rounded-md overflow-x-auto text-sm"><code>type User struct {
    ID    uint   `gorm:"primaryKey"`
    Name  string
    Email string
}

func InitDB() *gorm.DB {
    db, err := ConnectPostgres() // ho·∫∑c ConnectMySQL()
    if err != nil {
        log.Fatal("Kh√¥ng th·ªÉ k·∫øt n·ªëi DB:", err)
    }

    db.AutoMigrate(&User{})
    return db
}
</code></pre>

  <hr class="my-6">

  <h2 class="text-2xl font-semibold text-gray-800 mb-3">4Ô∏è‚É£ Qu·∫£n l√Ω k·∫øt n·ªëi to√†n c·ª•c</h2>
  <p class="mb-3">ƒê·ªÉ tr√°nh t·∫°o l·∫°i k·∫øt n·ªëi m·ªói l·∫ßn x·ª≠ l√Ω request, n√™n kh·ªüi t·∫°o DB m·ªôt l·∫ßn khi ch·∫°y ·ª©ng d·ª•ng.</p>

  <h3 class="text-lg font-medium text-gray-700 mb-2">T·∫°o bi·∫øn to√†n c·ª•c trong <code>main.go</code></h3>
  <pre class="bg-gray-100 p-4 rounded-md overflow-x-auto text-sm"><code>var DB *gorm.DB

func main() {
    var err error
    DB, err = ConnectPostgres()
    if err != nil {
        log.Fatal("L·ªói k·∫øt n·ªëi database:", err)
    }

    e := echo.New()
    e.Logger.Fatal(e.Start(":8080"))
}
</code></pre>

  <ul class="list-disc list-inside mt-4 mb-6 text-gray-700">
    <li>DB ch·ªâ kh·ªüi t·∫°o 1 l·∫ßn</li>
    <li>D·ªÖ d√πng trong to√†n ·ª©ng d·ª•ng</li>
    <li>H·ªó tr·ª£ refactor n√¢ng cao b·∫±ng Dependency Injection</li>
  </ul>

  <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-3">üöÄ Refactor n√¢ng cao v·ªõi Dependency Injection (DI)</h3>
  <p class="mb-3">Thay v√¨ d√πng bi·∫øn to√†n c·ª•c, b·∫°n c√≥ th·ªÉ inject DB v√†o handler ƒë·ªÉ code d·ªÖ test h∆°n.</p>

  <h4 class="text-lg font-medium text-gray-700 mb-2">1. Struct handler</h4>
  <pre class="bg-gray-100 p-4 rounded-md overflow-x-auto text-sm"><code>type Handler struct {
    DB *gorm.DB
}
</code></pre>

  <h4 class="text-lg font-medium text-gray-700 mt-4 mb-2">2. Kh·ªüi t·∫°o trong <code>main.go</code></h4>
  <pre class="bg-gray-100 p-4 rounded-md overflow-x-auto text-sm"><code>func main() {
    db, err := ConnectPostgres()
    if err != nil {
        log.Fatal("L·ªói k·∫øt n·ªëi DB:", err)
    }

    h := &Handler{DB: db}

    e := echo.New()
    e.GET("/users", h.GetUsers)
    e.Logger.Fatal(e.Start(":8080"))
}
</code></pre>

  <h4 class="text-lg font-medium text-gray-700 mt-4 mb-2">3. Handler s·ª≠ d·ª•ng DB</h4>
  <pre class="bg-gray-100 p-4 rounded-md overflow-x-auto text-sm"><code>func (h *Handler) GetUsers(c echo.Context) error {
    var users []User
    if err := h.DB.Find(&users).Error; err != nil {
        return c.JSON(http.StatusInternalServerError, map[string]string{
            "error": "Kh√¥ng th·ªÉ l·∫•y danh s√°ch user",
        })
    }
    return c.JSON(http.StatusOK, users)
}
</code></pre>

  <p class="font-medium text-gray-700 mt-4 mb-2">üí° L·ª£i √≠ch c·ªßa DI:</p>
  <ul class="list-disc list-inside text-gray-700">
    <li>Kh√¥ng d√πng bi·∫øn to√†n c·ª•c</li>
    <li>D·ªÖ vi·∫øt test</li>
    <li>D·ªÖ m·ªü r·ªông (config, logger, service...)</li>
  </ul>

  <p class="mt-4 text-gray-600">ƒê√¢y l√† b∆∞·ªõc ƒë·ªám cho Clean Architecture ho·∫∑c ki·∫øn tr√∫c theo t·∫ßng (Layered Architecture).</p>

{{ template "footer.html" . }}
